{"remainingRequest":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\src\\components\\table\\advance\\SearchArea.vue?vue&type=style&index=0&id=db55deda&scoped=true&lang=less&","dependencies":[{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\src\\components\\table\\advance\\SearchArea.vue","mtime":1637637094000},{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\style-resources-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\maxzh\\OneDrive\\桌面\\vue-antd-admin-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouc2VhcmNoLWFyZWF7CiAgLnNlbGVjdC1yb290ewogICAgdGV4dC1hbGlnbjogbGVmdDsKICB9CiAgbWFyZ2luOiAtNHB4IDA7CiAgLnNlYXJjaC1pdGVtewogICAgbWFyZ2luOiA0cHggNHB4OwogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgLnRpdGxlewogICAgICBwYWRkaW5nOiA0cHggOHB4OwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAuY2xvc2V7CiAgICAgICAgY29sb3I6IEB0ZXh0LWNvbG9yLXNlY29uZDsKICAgICAgICBtYXJnaW4tbGVmdDogNHB4OwogICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogICAgICAgIDpob3ZlcnsKICAgICAgICAgIGNvbG9yOiBAdGV4dC1jb2xvcjsKICAgICAgICB9CiAgICAgIH0KICAgICAgLnN3aXRjaHsKICAgICAgICBtYXJnaW4tbGVmdDogNHB4OwogICAgICB9CiAgICAgIC50aW1lLXBpY2tlcnsKICAgICAgICBtYXJnaW4tbGVmdDogNHB4OwogICAgICAgIHdpZHRoOiA5NnB4OwogICAgICB9CiAgICAgIC5kYXRlLXBpY2tlcnsKICAgICAgICBtYXJnaW4tbGVmdDogNHB4OwogICAgICAgIHdpZHRoOiAxMjBweDsKICAgICAgfQogICAgICAuZGF0ZXRpbWUtcGlja2VyewogICAgICAgIG1hcmdpbi1sZWZ0OiA0cHg7CiAgICAgICAgd2lkdGg6IDE5NXB4OwogICAgICB9CiAgICAgIC52YWx1ZXsKICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICBmbGV4OjE7CiAgICAgICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICAgICAgICBtYXgtd2lkdGg6IDE0NHB4OwogICAgICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogICAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsKICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgICB9CiAgICAgICYuYWN0aXZlewogICAgICAgIGJhY2tncm91bmQtY29sb3I6IEBsYXlvdXQtYmctY29sb3I7CiAgICAgIH0KICAgIH0KICAgIC5pY29uLWRvd257CiAgICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgIH0KICB9CiAgLnNlYXJjaC1vdmVybGF5ewogICAgcGFkZGluZzogOHB4IDBweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICB9CiAgLnNlbGVjdHsKICAgIG1hcmdpbi1sZWZ0OiA0cHg7CiAgICBtYXgtd2lkdGg6IDE0NHB4OwogICAgbWluLXdpZHRoOiA5NnB4OwogICAgdGV4dC1hbGlnbjogbGVmdDsKICB9CiAgLm9wZXJhdGlvbnN7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgbWFyZ2luOiAtNnB4IDA7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAuYnRuewogICAgfQogIH0KfQo="},{"version":3,"sources":["SearchArea.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SearchArea.vue","sourceRoot":"src/components/table/advance","sourcesContent":["<template>\n  <div class=\"search-area\" ref=\"root\">\n    <div class=\"select-root\" ref=\"selectRoot\"></div>\n    <div class=\"search-item\" :key=\"index\" v-for=\"(col, index) in searchCols\">\n      <div v-if=\"col.dataType === 'boolean'\" :class=\"['title', {active: col.search.value !== undefined}]\">\n        <template v-if=\"col.title\">\n          {{col.title}}:\n        </template>\n        <slot v-else-if=\"col.slots && col.slots.title\" :name=\"col.slots.title\"></slot>\n        <a-switch @change=\"onSwitchChange(col)\" class=\"switch\" v-model=\"col.search.value\" size=\"small\"\n                  :checked-children=\"(col.search.switchOptions && col.search.switchOptions.checkedText) || '是'\"\n                  :un-checked-children=\"(col.search.switchOptions && col.search.switchOptions.uncheckedText) || '否'\"\n        />\n        <a-icon v-if=\"col.search.value !== undefined\" class=\"close\" @click=\"e => onCloseClick(e, col)\" type=\"close-circle\" theme=\"filled\" />\n      </div>\n      <div v-else-if=\"col.dataType === 'time'\" :class=\"['title', {active: col.search.value}]\">\n        <template v-if=\"col.title\">\n          {{col.title}}:\n        </template>\n        <slot v-else-if=\"col.slots && col.slots.title\" :name=\"col.slots.title\"></slot>\n        <a-time-picker :format=\"col.search.format\" v-model=\"col.search.value\" placeholder=\"选择时间\" @change=\"(time, timeStr) => onCalendarChange(time, timeStr, col)\" @openChange=\"open => onCalendarOpenChange(open, col)\" class=\"time-picker\" size=\"small\" :get-popup-container=\"() => $refs.root\"/>\n      </div>\n      <div v-else-if=\"col.dataType === 'date'\" :class=\"['title', {active: col.search.value}]\">\n        <template v-if=\"col.title\">\n          {{col.title}}:\n        </template>\n        <slot v-else-if=\"col.slots && col.slots.title\" :name=\"col.slots.title\"></slot>\n        <a-date-picker :format=\"col.search.format\" v-model=\"col.search.value\" @change=\"onDateChange(col)\" class=\"date-picker\" size=\"small\" :getCalendarContainer=\"() => $refs.root\"/>\n      </div>\n      <div v-else-if=\"col.dataType === 'datetime'\" class=\"title datetime active\">\n        <template v-if=\"col.title\">\n          {{col.title}}:\n        </template>\n        <slot v-else-if=\"col.slots && col.slots.title\" :name=\"col.slots.title\"></slot>\n        <a-date-picker :format=\"col.search.format\" v-model=\"col.search.value\" @change=\"(date, dateStr) => onCalendarChange(date, dateStr, col)\" @openChange=\"open => onCalendarOpenChange(open, col)\" class=\"datetime-picker\" size=\"small\" show-time :getCalendarContainer=\"() => $refs.root\"/>\n      </div>\n      <div v-else-if=\"col.dataType === 'select'\" :class=\"['title', {active: col.search.value !== undefined}]\">\n        <template v-if=\"col.title\">\n          {{col.title}}:\n        </template>\n        <slot v-else-if=\"col.slots && col.slots.title\" :name=\"col.slots.title\"></slot>\n        <a-select :allowClear=\"true\" :options=\"col.search.selectOptions\" v-model=\"col.search.value\" placeholder=\"请选择...\" @change=\"onSelectChange(col)\" class=\"select\" slot=\"content\" size=\"small\" :get-popup-container=\"() => $refs.selectRoot\">\n        </a-select>\n      </div>\n      <div v-else :class=\"['title', {active: col.search.value}]\">\n        <a-popover @visibleChange=\"onVisibleChange(col, index)\" v-model=\"col.search.visible\" placement=\"bottom\" :trigger=\"['click']\" :get-popup-container=\"() => $refs.root\">\n          <template v-if=\"col.title\">\n            {{col.title}}\n          </template>\n          <slot v-else-if=\"col.slots && col.slots.title\" :name=\"col.slots.title\"></slot>\n          <div class=\"value \" v-if=\"col.search.value\">:&nbsp;&nbsp;{{col.search.format && typeof col.search.format === 'function' ? col.search.format(col.search.value) : col.search.value}}</div>\n          <a-icon v-if=\"!col.search.value\" class=\"icon-down\" type=\"down\"/>\n          <div class=\"operations\" slot=\"content\">\n            <a-button @click=\"onCancel(col)\" class=\"btn\" size=\"small\" type=\"link\">取消</a-button>\n            <a-button @click=\"onConfirm(col)\" class=\"btn\" size=\"small\" type=\"primary\">确认</a-button>\n          </div>\n          <div class=\"search-overlay\" slot=\"title\">\n            <a-input :id=\"`${searchIdPrefix}${index}`\" :allow-clear=\"true\" @keyup.esc=\"onCancel(col)\" @keyup.enter=\"onConfirm(col)\" v-model=\"col.search.value\" size=\"small\" />\n          </div>\n        </a-popover>\n        <a-icon v-if=\"col.search.value\" @click=\"e => onCloseClick(e, col)\" class=\"close\" type=\"close-circle\" theme=\"filled\"/>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  import fastEqual from 'fast-deep-equal'\n  import moment from 'moment'\n\n  export default {\n    name: 'SearchArea',\n    props: ['columns', 'formatConditions'],\n    inject: ['table'],\n    created() {\n      this.formatColumns(this.columns)\n    },\n    watch: {\n      columns(newVal, oldVal) {\n        if (newVal != oldVal) {\n          this.formatColumns(newVal)\n        }\n      },\n      searchCols(newVal, oldVal) {\n        if (newVal.length != oldVal.length) {\n          const newConditions = this.getConditions(newVal)\n          const newSearchOptions = this.getSearchOptions(newVal)\n          if (!fastEqual(newConditions, this.conditions)) {\n            this.conditions = newConditions\n            this.searchOptions = newSearchOptions\n            this.$emit('change', this.conditions, this.searchOptions)\n          }\n        }\n      }\n    },\n    data() {\n      return {\n        conditions: {},\n        searchOptions: []\n      }\n    },\n    computed: {\n      searchCols() {\n        return this.columns.filter(item => item.searchAble)\n      },\n      searchIdPrefix() {\n        return this.table.id + '-ipt-'\n      }\n    },\n    methods: {\n      onCloseClick(e, col) {\n        e.preventDefault()\n        e.stopPropagation()\n        col.search.value = undefined\n        const {backup, value} = col.search\n        if (backup !== value) {\n          this.backupAndEmitChange(col)\n        }\n      },\n      onCancel(col) {\n        col.search.value = col.search.backup\n        col.search.visible = false\n      },\n      onConfirm(col) {\n        const {backup, value} = col.search\n        col.search.visible = false\n        if (backup !== value) {\n          this.backupAndEmitChange(col)\n        }\n      },\n      onSwitchChange(col) {\n        const {backup, value} = col.search\n        if (backup !== value) {\n          this.backupAndEmitChange(col)\n        }\n      },\n      onSelectChange(col) {\n        this.backupAndEmitChange(col)\n      },\n      onCalendarOpenChange(open, col) {\n        col.search.visible = open\n        const {momentEqual, backupAndEmitChange} = this\n        const {value, backup, format} = col.search\n        if (!open && !momentEqual(value, backup, format)) {\n          backupAndEmitChange(col, moment(value))\n        }\n      },\n      onCalendarChange(date, dateStr, col) {\n        const {momentEqual, backupAndEmitChange} = this\n        const {value, backup, format} = col.search\n        if (!col.search.visible && !momentEqual(value, backup, format)) {\n          backupAndEmitChange(col, moment(value))\n        }\n      },\n      onDateChange(col) {\n        const {momentEqual, backupAndEmitChange} = this\n        const {value, backup, format} = col.search\n        if (!momentEqual(value, backup, format)) {\n          backupAndEmitChange(col, moment(value))\n        }\n      },\n      getFormat(col) {\n        if (col.search && col.search.format) {\n          return col.search.format\n        }\n        const dataType = col.dataType\n        switch(dataType) {\n          case 'time': return 'HH:mm:ss'\n          case 'date': return 'YYYY-MM-DD'\n          case 'datetime': return 'YYYY-MM-DD HH:mm:ss'\n          default: return undefined\n        }\n      },\n      backupAndEmitChange(col, backValue = col.search.value) {\n        const {getConditions, getSearchOptions} = this\n        col.search.backup = backValue\n        this.conditions = getConditions(this.searchCols)\n        this.searchOptions = getSearchOptions(this.searchCols)\n        this.$emit('change', this.conditions, this.searchOptions)\n      },\n      getConditions(columns) {\n        const conditions = {}\n        columns.filter(item => item.search.value !== undefined && item.search.value !== '' && item.search.value !== null)\n          .forEach(col => {\n            const {value, format} = col.search\n            if (this.formatConditions && format) {\n              if (typeof format === 'function') {\n                conditions[col.dataIndex] = format(col.search.value)\n              } else if (typeof format === 'string' && value.constructor.name === 'Moment') {\n                conditions[col.dataIndex] = value.format(format)\n              } else {\n                conditions[col.dataIndex] = value\n              }\n            } else {\n              conditions[col.dataIndex] = value\n            }\n          })\n        return conditions\n      },\n      getSearchOptions(columns) {\n        return columns.filter(item => item.search.value !== undefined && item.search.value !== '' && item.search.value !== null)\n          .map(({dataIndex, search}) => ({field: dataIndex, value: search.value, format: search.format}))\n      },\n      onVisibleChange(col, index) {\n        if (!col.search.visible) {\n          col.search.value = col.search.backup\n        } else {\n          let input = document.getElementById(`${this.searchIdPrefix}${index}`)\n          if (input) {\n            setTimeout(() => {input.focus()}, 0)\n          } else {\n            this.$nextTick(() => {\n              input = document.getElementById(`${this.searchIdPrefix}${index}`)\n              input.focus()\n            })\n          }\n        }\n      },\n      momentEqual(target, source, format) {\n        if (target === source) {\n          return true\n        } else if (target && source && target.format(format) === source.format(format)) {\n          return true\n        }\n        return false\n      },\n      formatColumns(columns) {\n        columns.forEach(item => {\n          this.$set(item, 'search', {...item.search, visible: false, value: undefined, format: this.getFormat(item)})\n        })\n      }\n    }\n  }\n</script>\n\n<style scoped lang=\"less\">\n.search-area{\n  .select-root{\n    text-align: left;\n  }\n  margin: -4px 0;\n  .search-item{\n    margin: 4px 4px;\n    display: inline-block;\n    .title{\n      padding: 4px 8px;\n      cursor: pointer;\n      border-radius: 4px;\n      user-select: none;\n      display: inline-flex;\n      align-items: center;\n      .close{\n        color: @text-color-second;\n        margin-left: 4px;\n        font-size: 12px;\n        vertical-align: middle;\n        :hover{\n          color: @text-color;\n        }\n      }\n      .switch{\n        margin-left: 4px;\n      }\n      .time-picker{\n        margin-left: 4px;\n        width: 96px;\n      }\n      .date-picker{\n        margin-left: 4px;\n        width: 120px;\n      }\n      .datetime-picker{\n        margin-left: 4px;\n        width: 195px;\n      }\n      .value{\n        display: inline-block;\n        overflow: hidden;\n        flex:1;\n        vertical-align: middle;\n        max-width: 144px;\n        text-overflow: ellipsis;\n        word-break: break-all;\n        white-space: nowrap;\n      }\n      &.active{\n        background-color: @layout-bg-color;\n      }\n    }\n    .icon-down{\n      vertical-align: middle;\n      font-size: 12px;\n    }\n  }\n  .search-overlay{\n    padding: 8px 0px;\n    text-align: center;\n  }\n  .select{\n    margin-left: 4px;\n    max-width: 144px;\n    min-width: 96px;\n    text-align: left;\n  }\n  .operations{\n    display: flex;\n    margin: -6px 0;\n    justify-content: space-between;\n    .btn{\n    }\n  }\n}\n</style>\n"]}]}